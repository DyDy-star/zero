# Token熵分布分析报告

## 概述

本报告分析了v1、v2、v3三个版本（每个版本包含5轮迭代）的question_entropy日志中的token熵分布。以80%分位数作为阈值，将tokens分为高熵和低熵两类，并详细分析了高熵tokens的特征。

---

## 1. 整体熵分布统计

### V1版本
- **总token数**: 964,763
- **平均熵**: 1.5292
- **标准差**: 1.6932
- **中位数**: 1.0000
- **熵范围**: [0.0000, 10.0000]
- **80分位数阈值**: 2.7500

**分位数分布**:
- 25%: 0.125
- 50%: 1.000
- 75%: 2.375
- 90%: 3.750
- 95%: 4.938
- 99%: 7.438

**高熵tokens (≥80分位数)**:
- 数量: 197,653 (20.49%)
- 平均熵: 4.2412
- 标准差: 1.4536

**低熵tokens (<80分位数)**:
- 平均熵: 0.8304
- 标准差: 0.8234

---

### V2版本
- **总token数**: 865,567
- **平均熵**: 1.3526
- **标准差**: 1.7239
- **中位数**: 0.7500
- **熵范围**: [0.0000, 10.2500]
- **80分位数阈值**: 2.3750

**分位数分布**:
- 25%: 0.000
- 50%: 0.750
- 75%: 2.000
- 90%: 3.375
- 95%: 4.812
- 99%: 8.312

**高熵tokens (≥80分位数)**:
- 数量: 178,084 (20.57%)
- 平均熵: 4.0668
- 标准差: 1.8023

**低熵tokens (<80分位数)**:
- 平均熵: 0.6495
- 标准差: 0.7053

---

### V3版本
- **总token数**: 722,022
- **平均熵**: 1.1336
- **标准差**: 1.4551
- **中位数**: 0.6250
- **熵范围**: [0.0000, 10.4375]
- **80分位数阈值**: 2.0000

**分位数分布**:
- 25%: 0.125
- 50%: 0.625
- 75%: 1.625
- 90%: 2.750
- 95%: 3.750
- 99%: 7.688

**高熵tokens (≥80分位数)**:
- 数量: 146,336 (20.27%)
- 平均熵: 3.3809
- 标准差: 1.6521

**低熵tokens (<80分位数)**:
- 平均熵: 0.5623
- 标准差: 0.5929

---

## 2. 版本间趋势分析

### 关键观察
1. **Token数量递减**: V1 (964K) → V2 (865K) → V3 (722K)
   - 说明随着迭代，生成的文本更加简洁

2. **平均熵递减**: V1 (1.53) → V2 (1.35) → V3 (1.13)
   - 模型的不确定性逐步降低，预测更加confident

3. **80分位数阈值递减**: V1 (2.75) → V2 (2.38) → V3 (2.00)
   - 高熵的定义标准在降低，整体分布向低熵移动

4. **高熵token平均熵递减**: V1 (4.24) → V2 (4.07) → V3 (3.38)
   - 即使是高熵tokens，其不确定性也在降低

5. **低熵token平均熵递减**: V1 (0.83) → V2 (0.65) → V3 (0.56)
   - 确定性tokens变得更加确定

---

## 3. 高熵Token详细分析

### V1版本高熵Tokens (阈值: 2.75)

**统计概况**:
- 总出现次数: 158,532
- 唯一tokens: 15,097

**Top 30高频高熵Tokens**:

| 排名 | Token | 出现次数 | 平均熵 | 最大熵 | 类型 |
|------|-------|----------|--------|--------|------|
| 1 | the | 6,394 | 3.91 | 9.63 | 冠词 |
| 2 | . | 6,055 | 4.13 | 9.75 | 标点 |
| 3 | , | 5,947 | 4.05 | 9.63 | 标点 |
| 4 | $ | 3,707 | 3.74 | 9.88 | 数学符号 |
| 5 | a | 3,646 | 4.07 | 9.75 | 冠词 |
| 6 | of | 3,487 | 3.90 | 9.50 | 介词 |
| 7 | \ | 2,561 | 4.20 | 9.63 | LaTeX符号 |
| 8 | and | 2,305 | 3.99 | 9.50 | 连词 |
| 9 | to | 2,249 | 4.09 | 9.50 | 介词 |
| 10 | ) | 2,059 | 4.29 | 10.00 | 标点 |

**按类型分类**:
- **数字tokens**: 4,258次 (440个唯一值)
  - Top: 1, 2, 3, 0, 4, 10, 5, 6, 100, 8
- **标点符号**: 39,195次 (237个唯一值)
  - Top: . , $ \ ) - ( { : }
- **单词tokens**: 114,055次 (13,708个唯一值)
  - Top: the, a, of, and, to, is, that, in, with, are
- **特殊tokens**: 1,024次 (712个唯一值)
  - Top: final_answer, a_, 2n, h_, 2x, S_, r_1, x_1

---

### V2版本高熵Tokens (阈值: 2.375)

**统计概况**:
- 总出现次数: 127,071
- 唯一tokens: 11,682

**Top 30高频高熵Tokens**:

| 排名 | Token | 出现次数 | 平均熵 | 最大熵 | 类型 |
|------|-------|----------|--------|--------|------|
| 1 | the | 5,240 | 3.42 | 9.19 | 冠词 |
| 2 | . | 4,949 | 3.81 | 9.75 | 标点 |
| 3 | , | 4,619 | 3.61 | 9.50 | 标点 |
| 4 | $ | 3,750 | 3.26 | 9.38 | 数学符号 |
| 5 | a | 3,244 | 3.58 | 9.44 | 冠词 |
| 6 | of | 3,130 | 3.43 | 9.25 | 介词 |
| 7 | \ | 1,988 | 3.90 | 9.56 | LaTeX符号 |
| 8 | and | 1,841 | 3.50 | 9.06 | 连词 |
| 9 | is | 1,783 | 3.48 | 9.75 | 动词 |
| 10 | that | 1,625 | 3.28 | 9.13 | 连词 |

**按类型分类**:
- **数字tokens**: 3,615次 (315个唯一值)
  - Top: 1, 2, 3, 0, 5, 4, 10, 6, 100, 8
- **标点符号**: 29,765次 (167个唯一值)
  - Top: . , $ \ ) ( - { } :
- **单词tokens**: 92,965次 (10,729个唯一值)
  - Top: the, a, of, and, is, that, to, in, are, with
- **特殊tokens**: 726次 (471个唯一值)
  - Top: 01cm, final_answer, a_0, a_1, a_, a_n, 2n, 3n

---

### V3版本高熵Tokens (阈值: 2.0)

**统计概况**:
- 总出现次数: 110,303
- 唯一tokens: 8,538

**Top 30高频高熵Tokens**:

| 排名 | Token | 出现次数 | 平均熵 | 最大熵 | 类型 |
|------|-------|----------|--------|--------|------|
| 1 | the | 5,070 | 2.98 | 9.13 | 冠词 |
| 2 | $ | 4,841 | 2.64 | 9.19 | 数学符号 |
| 3 | . | 3,806 | 3.28 | 9.50 | 标点 |
| 4 | , | 3,781 | 3.12 | 9.06 | 标点 |
| 5 | of | 2,997 | 2.90 | 8.63 | 介词 |
| 6 | a | 2,916 | 3.14 | 8.75 | 冠词 |
| 7 | that | 2,030 | 2.82 | 9.50 | 连词 |
| 8 | \ | 1,678 | 2.98 | 8.69 | LaTeX符号 |
| 9 | is | 1,670 | 3.00 | 9.00 | 动词 |
| 10 | and | 1,486 | 3.06 | 8.75 | 连词 |

**按类型分类**:
- **数字tokens**: 2,882次 (202个唯一值)
  - Top: 1, 2, 3, 0, 10, 5, 4, 100, 6, 7
- **标点符号**: 24,518次 (91个唯一值)
  - Top: $ . , \ ) ( - } { >
- **单词tokens**: 82,350次 (7,916个唯一值)
  - Top: the, of, a, that, is, and, to, Let, Find, in
- **特殊tokens**: 553次 (329个唯一值)
  - Top: a_, a_i, final_answer, sum_, a_1, 2n, 2x, a_n

---

## 4. 高熵Token的核心特征

### 4.1 语言功能词占主导

**冠词和限定词** (the, a, an):
- 这些词在数学问题描述中连接概念，位置灵活
- 模型在选择使用"the"还是"a"时存在较高不确定性
- V1-V3中持续保持高熵

**介词** (of, to, in, with, for, on):
- 表达数学关系时有多种表达方式
- 例如："ratio of A to B" vs "ratio between A and B"
- 介词选择的多样性导致高熵

**连词** (and, that, which, or):
- 连接从句和短语时有多种语法选择
- 逻辑关系的表达方式多样

### 4.2 标点符号高熵

**数学符号** ($, \, {, }, (, )):
- LaTeX格式的数学表达式开始/结束位置不确定
- 是否需要用$包裹数学符号存在选择
- 括号的嵌套层次选择

**句子标点** (. , : ; -):
- 句子结构的选择多样
- 逗号的使用位置（是否需要逗号分隔）
- 破折号vs冒号的选择

### 4.3 数学问题的特定词汇

**问题引导词**:
- Find (V3平均熵2.47，最低)
- Let (V3平均熵2.80)
- Consider (V3平均熵3.42)
- Given (V3平均熵3.20)

**数学概念词**:
- number (在三个版本中都是高频高熵)
- sum, product, ratio
- equation, solution

### 4.4 特殊tokens和变量

**数学变量** (a_, x_1, a_n, sum_):
- 变量命名的不确定性
- 下标的选择

**特殊标记**:
- final_answer (在三个版本中都出现)
- 格式标记的位置选择

---

## 5. 关键发现

### 5.1 高熵主要来源于"如何表达"而非"表达什么"

分析表明，高熵tokens主要是：
1. **功能词** (冠词、介词、连词) - 占高熵tokens的70%+
2. **标点符号** - 占15-25%
3. **数学格式符号** - 占10-15%
4. **内容词** (数学概念、数字) - 仅占5-10%

这说明模型对**内容**相对确定，但对**表达方式**存在较大不确定性。

### 5.2 迭代改进效果显著

从V1到V3:
- 高熵tokens的平均熵下降了20% (4.24 → 3.38)
- 整体平均熵下降了26% (1.53 → 1.13)
- 唯一高熵tokens数量减少了43% (15,097 → 8,538)

说明模型在迭代过程中：
- 学会了更一致的表达方式
- 减少了不必要的语言变化
- 提高了生成的确定性

### 5.3 数学符号使用的不确定性

LaTeX相关符号 ($, \, {, }) 持续保持高熵：
- 是否需要数学模式的判断
- 公式边界的确定
- 格式选择的多样性

这是数学问题生成中的一个持续挑战。

### 5.4 问题引导词的熵值差异

V3版本中：
- "Find" (2.47) - 最确定，标准的问题开始
- "Let" (2.80) - 较确定，定义变量
- "Given" (3.20) - 中等，给定条件
- "Consider" (3.42) - 较高，更开放的引导

反映了不同问题类型的表达确定性差异。

---

## 6. 建议

### 6.1 针对高熵tokens的优化

1. **标准化功能词使用**
   - 建立一致的冠词使用规则
   - 统一介词选择模式

2. **规范数学符号格式**
   - 明确LaTeX符号的使用边界
   - 统一数学表达式的格式

3. **模板化问题引导**
   - 为不同问题类型设计标准开头
   - 减少引导词的随机性

### 6.2 进一步分析方向

1. **上下文相关性分析**
   - 分析高熵tokens在不同上下文中的熵值变化
   - 识别导致高熵的特定上下文模式

2. **语义等价性分析**
   - 研究高熵位置的不同选择是否语义等价
   - 区分"有益的多样性"和"无益的随机性"

3. **人工评估**
   - 对高熵位置进行人工评估
   - 判断不确定性是否影响问题质量

---

## 7. 结论

本分析揭示了question_entropy日志中token熵分布的关键特征：

1. **高熵tokens主要是功能词和格式符号**，而非数学内容本身
2. **从V1到V3的迭代显著降低了整体熵**，提高了生成的一致性
3. **约20%的tokens被定义为高熵**，这些tokens的平均熵是低熵tokens的4-6倍
4. **数学符号格式和语言表达方式**是主要的不确定性来源

这些发现为进一步优化数学问题生成模型提供了明确的方向。

---

**生成时间**: 2025-12-20  
**数据来源**: question_entropy_logs (v1-v3, step1-5)  
**分析脚本**: analyze_token_entropy.py, analyze_high_entropy_tokens_detail.py

